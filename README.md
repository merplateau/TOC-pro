# PDF Reader Pro - 极简 PDF 阅读器

一款专为 macOS 设计的极简 PDF 阅读器，支持 AI 智能识别目录、层级化目录管理、页码偏移设置等功能。

## 功能特性

### 核心功能
- **PDF 预览**：流畅的页面浏览体验，支持键盘和鼠标操作
- **智能目录识别**：使用 AI 自动识别 PDF 文档目录结构
- **层级化目录**：支持多级目录展示和编辑
- **页码偏移**：自动处理印刷页码与 PDF 页码的差异
- **目录导出**：将编辑好的目录写入 PDF 文件

### 设计特色
- **极简界面**：苹果风格的 UI 设计，清晰直观
- **流畅动画**：精心设计的过渡效果和交互反馈
- **本地处理**：除 AI 识别外，所有操作完全在本地进行
- **内存优化**：智能内存管理，防止内存泄露

## 技术栈

- **Electron**: 跨平台桌面应用框架
- **PDF.js**: PDF 渲染和解析
- **pdf-lib**: PDF 文档操作和目录写入
- **原生 JavaScript**: 无额外前端框架依赖

## 项目结构

```
pdf-reader-redesign/
├── src/
│   ├── main/                 # Electron 主进程
│   │   ├── main.js          # 主进程入口
│   │   └── preload.js       # 预加载脚本
│   └── renderer/            # 渲染进程
│       ├── index.html       # 主页面
│       ├── css/
│       │   └── style.css    # 样式文件
│       └── js/
│           ├── app.js       # 应用主逻辑
│           └── memory-manager.js  # 内存管理
├── package.json
└── README.md
```

## 开发指南

### 安装依赖

```bash
pnpm install
```

### 启动开发模式

```bash
pnpm start
```

### 构建应用

```bash
# 构建 macOS 应用（DMG）
pnpm build

# 构建到目录（不打包）
pnpm build:dir
```

## 使用说明

### 基本操作

1. **打开文件**：点击欢迎页面的"打开 PDF 文件"按钮，或直接拖拽 PDF 文件到窗口
2. **浏览页面**：使用左右箭头键或点击页码指示器的按钮翻页
3. **查看目录**：点击工具栏的目录按钮（或按 `Cmd+T`）打开目录抽屉

### 目录识别

1. 打开 PDF 文件后，点击目录抽屉中的"识别目录"按钮
2. 首次使用需要在设置中配置 API Key
3. 识别完成后，目录会自动显示在抽屉中
4. 点击目录项可快速跳转到对应页面

### 目录编辑

1. 在目录抽屉中点击"编辑目录"按钮
2. 在弹出的编辑窗口中可以：
   - 添加新的目录项
   - 修改标题、页码和层级
   - 删除不需要的目录项
   - 导入/导出 JSON 格式的目录数据
3. 编辑完成后点击"保存"

### 页码偏移

如果 PDF 的印刷页码与实际 PDF 页码不一致（例如封面、前言等），可以在设置中配置页码偏移：

1. 打开设置页面（点击工具栏的设置按钮或按 `Cmd+,`）
2. 在"页码偏移"部分输入：
   - 印刷页码：书中标注的页码
   - 对应 PDF 页码：该页在 PDF 中的实际页码
3. 系统会自动计算偏移量，并在写入目录时自动应用

### 导出 PDF

1. 编辑好目录后，在目录抽屉中点击"导出 PDF"按钮
2. 选择保存位置和文件名
3. 导出的 PDF 文件将包含完整的目录结构

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Cmd+O` | 打开文件 |
| `Cmd+T` | 打开/关闭目录 |
| `Cmd+,` | 打开设置 |
| `←` / `→` | 上一页/下一页 |
| `ESC` | 关闭当前面板 |

## API 配置

### 支持的 API

本应用使用火山引擎的豆包模型进行目录识别：

- **模型**：doubao-seed-1-6-flash-250828
- **API 地址**：https://ark.cn-beijing.volces.com/api/v3/responses

### 获取 API Key

1. 访问火山引擎控制台
2. 创建 API Key
3. 在应用设置中填入 API Key

### 测试 API

在设置页面填入 API Key 后，点击"测试连接"按钮验证配置是否正确。

## 内存管理

应用实现了完善的内存管理机制：

- **Canvas 对象池**：复用 Canvas 元素，减少创建和销毁开销
- **及时清理**：切换文件时自动清理旧文档的所有引用
- **内存监控**：定期监控内存使用情况（开发模式下在控制台输出）
- **页面清理**：渲染完成后立即清理 PDF.js 页面对象

## 注意事项

1. **API 调用限制**：目录识别功能会调用外部 API，请注意使用频率
2. **大文件处理**：对于页数较多的 PDF，目录识别可能需要较长时间
3. **目录识别准确性**：AI 识别的准确性取决于 PDF 的格式和内容质量，建议识别后手动检查
4. **本地处理**：除目录识别外，所有 PDF 操作都在本地完成，不会上传文件到服务器

## 常见问题

### 无法打开 PDF 文件

- 确保 PDF 文件未损坏
- 检查文件权限

### 目录识别失败

- 检查 API Key 是否正确配置
- 确认网络连接正常
- 点击"测试连接"验证 API 配置

### 导出的 PDF 无目录

- 确保在导出前已经识别或编辑了目录
- 检查目录项的页码是否在有效范围内

## 开发计划

- [ ] 支持 PDF 注释和标记
- [ ] 添加书签功能
- [ ] 支持全文搜索
- [ ] 添加深色模式
- [ ] 支持 Windows 和 Linux 平台

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！
